<!doctype html>
<html lang="zh">
  <head>
    <!-- Place your kit's code here -->
    <title>BlueGhost Studio</title>
    <script src="https://kit.fontawesome.com/210a49543e.js" crossorigin="anonymous"></script>
    <script src="https://github.bgstudio.live/BG.js/BGMRPC/BGMRPC.js"></script>
    <script src="https://github.bgstudio.live/BG.js/BGPF/page_framework.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/less@4.1.2/dist/less.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<!--     <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch:wght@700&family=Poiret+One&family=Special+Elite&display=swap" rel="stylesheet"> -->
    
    <script>
        $(document).ready(() => {
            loadModules([
                "cms/cms.html"
            ], false).onEnd(() => {
                var qsa = __queryStringArray__(location.href);
                if (qsa.g)
                    CMS.RPCGRP = qsa.g;

                CMS.connect("wss://rpc.bgstudio.live", 8000).then(() => {
                    CMS.loadComponent('/site/components.pkg').then(null, (ret) => {
                        console.log('error:', ret);
                    }).then(() => {
                        var defaultStyle = compile($('<cms-style></cms-style>'));
                        $('head').append(defaultStyle.$);
                        return defaultStyle.load('/site/style/default').then(null, (ret) => {
                            console.log('no default style');
                        });
                    }).then(() => {
                        return CMS.loadComponent('/site/config').then(() => {
                            if (CMS.homePath != null) {
                                return CMS.node(CMS.homePath).then((node) => {
                                    CMS.homePath = node.id;
                                }, (ret) => {
                                    console.log('no exist home path');
                                    CMS.homePath = null;
                                });
                            }
                        }, (ret) => {
                            console.log('no config');
                        })
                    }).then(() => {
                        // var qsa = __queryStringArray__(location.href);
                        if (qsa.id)
                            CMS.open(qsa.id);
                        else if (qsa.p)
                            CMS.open(qsa.p);
                        else {
                            console.log("home path", CMS.homePath);
                            CMS.open(CMS.homePath);
                        }
                    });
                });
            });
        });
    </script>
  </head>
  <body></body>
</html>
